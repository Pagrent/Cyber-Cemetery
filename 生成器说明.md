# 赛博墓园生成器开发需求文档

## 一、项目背景与目标

我们有一个已完成前端开发的静态墓园网站。现在需要一个Python生成器 (`generator.py`)，将用户提供的墓碑数据自动转换为完整的静态网站。

生成器的核心任务：
- 读取JSON格式的墓碑数据。
- 验证并按ID升序排序。
- 自动分页生成HTML文件（第一页为 `index.html`，后续为 `page_2.html`, `page_3.html`...）。
- 复制相关的CSS、JS和图标等静态资源。

## 二、输入数据规范

### 1. 数据源目录结构

```
/tombstones_raw/        # 用户提供的原始数据文件夹 (可通过 config.yaml 修改)
├── 1.json              # 文件名必须是纯数字ID (无前导零)
├── 2.json
├── 10.json
└── ...                 # 可以有很多个
```

### 2. 墓碑JSON文件格式

每个JSON文件必须包含以下字段：

```json
{
  "id": "1",                                  // 必须：正整数字符串，与文件名（不含.json）完全一致
  "name": "数字旅人",                         // 必须：显示名称
  "avatar": "https://example.com/avatar.jpg", // 必须：头像URL
  "epitaph": "我曾在此处留下足迹...",         // 必须：碑文内容（支持换行）
  "created": "2024-03-15",                    // 可选：创建日期（YYYY-MM-DD格式）
  "links": [                                  // 可选：链接数组
    {
      "url": "https://github.com/user",       // 必须：完整URL
      "title": "GitHub"                       // 必须：链接显示文本
    }
  ]
}
```

### 3. 数据验证要求

生成器 (`generator.py`) 会严格验证以下内容，失败则报错并停止：

- 文件名与ID一致性：filename (去掉 `.json` 后缀) 必须等于 JSON 内的 `id` 字段。
- ID有效性：`id` 必须是有效的正整数字符串（例如 "1", "2", "10"）。它不是固定6位，也不需要前导零。
- 必需字段：`name`、`avatar`、`epitaph` 字段必须存在且非空。
- URL格式：`avatar` 必须是有效的HTTP/HTTPS URL（仅验证格式，不检查可达性）。
- 链接格式：`links` 数组中的每个对象必须同时包含 `url` 和 `title` 字段。
- 日期格式：如果 `created` 字段存在，必须是有效的 YYYY-MM-DD 格式。

## 三、配置选项 (config.yaml)

生成器通过 `config.yaml` 文件进行配置。其结构如下：

```yaml
per_page: 20                    # 每页墓碑数量
input_dir_name: "tombstones_raw" # 墓碑数据目录
output_dir_name: "dist"          # 输出目录
template_index_path: "index.html" # HTML模板文件路径
template_js_path: "js/main.js"   # JS模板文件路径 (程序中未使用)
template_css_path: "css/styles.css" # CSS模板文件路径 (程序中未使用)
assets_dir_name: "assets"        # 图标资源目录名
template_page_name_format: "page_{}.html" # 分页文件名格式
```

**注意**：程序目前只使用了 `per_page`, `input_dir_name`, `output_dir_name`, `template_index_path`, `assets_dir_name`, `template_page_name_format` 这几个配置项。`template_js_path` 和 `template_css_path` 在代码中被读取但未被用于复制逻辑。

## 四、生成器功能与输出

### 1. 核心处理流程

1. 从 `config.yaml` 读取配置。
2. 读取 `input_dir_name` 目录下的所有 `*.json` 文件。
3. 逐个验证JSON文件格式。
4. 将所有有效墓碑按ID的数值大小升序排序。
5. 根据 `per_page` 配置进行分页。
6. 读取 `template_index_path` 指定的HTML模板。
7. 为每一页生成独立的HTML文件，并将该页的墓碑数据注入到模板中。
8. 将 `js/`, `css/`, `assets/` 目录原样复制到输出目录。

### 2. 输出目录结构

生成器会将完整的静态网站输出到 `output_dir_name` 指定的目录（默认为 `./dist`）：

```
/dist/                          # 输出目录 (可通过 config.yaml 修改)
├── index.html                  # 第1页
├── page_2.html                 # 第2页
├── page_3.html                 # 第3页
├── css/
│   └── styles.css              # 从项目根目录的 css/ 复制而来
├── js/
│   └── main.js                 # 从项目根目录的 js/ 复制而来
└── assets/
    ├── sun.svg                 # 从项目根目录的 assets/ 复制而来
    └── moon.svg                # 从项目根目录的 assets/ 复制而来
```

### 3. HTML数据注入机制

生成器会修改HTML模板中的特定JavaScript变量，以传递数据给前端：

```javascript
// --- 由生成器注入的数据 ---
window.PAGE_DATA = [...];           // 当前页的墓碑数据数组
window.CURRENT_PAGE_NUMBER = 1;     // 当前页码
window.TOTAL_PAGES = 3;             // 总页数
// --- End of injected data ---
```

前端JavaScript (`main.js`) 会读取这些全局变量来渲染页面和分页导航。

## 五、关键注意事项

1. **ID灵活性**：ID是任意正整数字符串，不要求固定长度或前导零。排序时按数值大小进行。
2. **静态资源来源**：CSS、JS和图标文件是从项目根目录下的 `css/`, `js/`, `assets/` 文件夹复制的，而不是从一个单独的“模板”目录。
3. **错误处理**：任何数据验证失败都会导致生成器立即停止，并打印清晰的错误信息，指明是哪个文件的哪个字段出了问题。